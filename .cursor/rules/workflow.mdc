---
description: Global workflow rules for planning, implementation, and code quality
alwaysApply: true
---

# Workflow Rules

## Issue-Driven Development (Source of Truth)
- GitHub Issues are the single source of truth for all planned work
- Every feature, enhancement, or task must have a corresponding GitHub issue before work begins
- Every bug must be filed as a GitHub issue before fixing
- Do NOT start coding without an issue to reference

## Starting Work
1. Fetch the GitHub issue assigned to this task: `gh issue view <number>`
2. Confirm with user which issue we're working on
3. Assign yourself and add "in progress" label
4. Create a feature branch from up-to-date main: `git checkout main && git pull origin main && git checkout -b <branch>`
5. Implement the feature/fix per the issue description

## Planning Mode
- Output a concise plan before writing code
- Identify modules/components affected and design patterns to use
- Flag potential security risks (OWASP)
- If less than 90% sure about intent, ask clarifying questions

## Implementation Flow
1. Structure First: Break tasks into small functions, show signatures only
2. Wait for Approval: Do not implement until reviewed
3. One by One: Implement each function individually, not large blocks

## Code Standards
- No comments in code (exception: complex "why" logic)
- No lazy coding: never use `// ... rest of code` placeholders
- Read target file's imports, types, and style before generating code
- Pin dependency versions exactly (no `^` or `~` ranges)

## Security (OWASP)
- Never output API keys, passwords, or tokens
- Assume all input is malicious - use Zod for validation
- Use parameterized queries for SQL

## File Permissions
- Allowed to update `.env` file when adding/modifying environment variables
- Always update `.env.example` when adding new env vars (without actual values)

## Debugging
- Stop on test/build failures - do not proceed
- Analyze root cause before fixing, don't randomly patch

## Bug Workflow
1. File a GitHub issue with the `bug` label before fixing
2. Include: steps to reproduce, expected vs actual behavior
3. Assign and begin work per the Starting Work flow above

## Finalization
1. Run validation (build, lint, test)
2. Fix any failures automatically
3. If API routes or schemas changed, run `npm run openapi:generate` and commit updated `docs/openapi.json`
4. Ask for user confirmation
5. Create PR with `Closes #XX` to auto-close issue on merge
